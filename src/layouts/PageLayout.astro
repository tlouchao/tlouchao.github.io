---
import path from 'path';

import BaseHead from '../components/BaseHead.astro';
import NavBar from '../components/NavBar.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

import '../styles/layouts/pagelayout.scss'

import { ViewTransitions } from "astro:transitions";
import { SITE_TITLE, SITE_DESCRIPTION} from '../consts';
import {type FrontmatterProps} from '../interface';

import '@fontsource/oxygen';
import '@fontsource/roboto';

const {url, frontmatter, headings} = Astro.props as FrontmatterProps;
const headerImgSrc = '/freljord_splash.jpg';

let headingsFiltered = headings?.filter((heading) => heading.depth <= 3);
let headingsUrl : string[] = [];

if (url) headingsFiltered?.map((heading : {slug: string}) => headingsUrl.push(path.join(url, '#' + heading.slug)))

---

<!doctype html>
<html lang="en"> <!--transition:animate="none">-->
	<head>
        <ViewTransitions />
		<BaseHead title={SITE_TITLE}
                  description={SITE_DESCRIPTION}  
                  transition:persist/>
	</head>
	<body class="theme-dark">
        <NavBar />
        <div id="header-layout">
            <Header header={frontmatter?.title} headerImgSrc={headerImgSrc} />
            <div id="main-layout">
                <div id="main-layout-content">
                    <main>
                        <slot />
                    </main>
                    <aside>
                        <div id="aside-content">
                            <!-- <p id="aside-header">On This Page</p> -->
                            <ul>
                                {
                                    headingsFiltered?.map((heading, idx) => 
                                        <a href={headingsUrl[idx]}>
                                            <li>{heading.text}</li>
                                        </a>
                                    )
                                }
                            </ul>
                        </div>
                    </aside>
                </div>
            </div>
            <Footer />
        </div>
    </body>
</html>