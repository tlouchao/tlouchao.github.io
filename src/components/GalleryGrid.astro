---
import { GalleryItem } from './lit/GalleryItem.ts'
import '../styles/components/gallerygrid.scss'

import { fetchImg } from '../scripts/fetchImg'
import { type GalleryImageProp, transformImageProps } from '../scripts/transformImg'

const clouddir = import.meta.env.PUBLIC_CLOUD_DIR;

interface Props {
    subdir? : string;
    tags? : string[];
}

let { subdir = "", tags = [] } = Astro.props;

// Set img src to public URLs
let transform = "t_Thumbnail_360";
let items : GalleryImageProp[] = [];
let publicIds = await fetchImg(clouddir + '/' + subdir);
if (publicIds) items = transformImageProps(publicIds, transform);
---

<gallery-grid>
    <div id="gallery-grid">
        {items.map((x) => (
            // @ts-ignore
            <GalleryItem client:visible src={x.src} label={x.label} />
            )
        )}
    </div>
</gallery-grid>